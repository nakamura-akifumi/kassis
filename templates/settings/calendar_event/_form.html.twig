<div class="card shadow-sm">
    <div class="card-body">
        <div class="mb-3">
            <label class="form-label">UID</label>
            <input class="form-control" type="text" value="{{ event.uid }}" readonly>
        </div>
        <div class="mb-3">
            <label class="form-label">件名</label>
            <input class="form-control" type="text" name="summary" value="{{ event.summary ?? '' }}" required>
        </div>
        <div class="mb-3">
            <label class="form-label">閉館日設定（終日）</label>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label">開始日</label>
                    <input class="form-control" type="date" name="start_date" value="{{ event.dtStart ? event.dtStart|date('Y-m-d') : '' }}" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label">終了日</label>
                    <input class="form-control" type="date" name="end_date" value="{% if repeat.enabled and repeat.until %}{{ repeat.until }}{% elseif event.dtEnd %}{{ event.dtEnd|date('Y-m-d') }}{% endif %}">
                    <div class="form-text">繰り返し有効時は終了日が「繰り返し終了日」として使われます。</div>
                </div>
            </div>
            <div class="form-check mt-3">
                <input class="form-check-input" type="checkbox" name="repeat_enabled" value="1" id="repeatEnabled" {% if repeat.enabled %}checked{% endif %}>
                <label class="form-check-label" for="repeatEnabled">繰り返す</label>
            </div>
            <div class="mt-2">
                <label class="form-label">繰り返し頻度</label>
                <select class="form-select" name="repeat_type" id="repeatType">
                    <option value="" {% if not repeat.enabled %}selected{% endif %}>選択してください</option>
                    <option value="daily" {% if repeat.type == 'daily' %}selected{% endif %}>毎日</option>
                    <option value="weekly" {% if repeat.type == 'weekly' %}selected{% endif %}>毎週</option>
                    <option value="biweekly" {% if repeat.type == 'biweekly' %}selected{% endif %}>隔週</option>
                    <option value="monthly" {% if repeat.type == 'monthly' %}selected{% endif %}>毎月</option>
                    <option value="yearly" {% if repeat.type == 'yearly' %}selected{% endif %}>毎年</option>
                </select>
            </div>
        </div>
    </div>
</div>

<script>
    const repeatEnabled = document.getElementById('repeatEnabled');
    const repeatType = document.getElementById('repeatType');

    function syncRepeatState() {
        const enabled = repeatEnabled.checked;
        repeatType.disabled = !enabled;
        if (!enabled) {
            repeatType.value = '';
        }
    }

    repeatEnabled.addEventListener('change', syncRepeatState);
    syncRepeatState();
</script>
